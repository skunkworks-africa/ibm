name: Create Directory Structure with Initial Content

on:
  push:
    branches:
      - main

jobs:
  create-structure:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Create directories and files
      run: |
        set -x  # Enable debugging
        echo "Creating directories..."
        mkdir -p ibm/docs || { echo "Failed to create ibm/docs"; exit 1; }
        mkdir -p ibm/scripts || { echo "Failed to create ibm/scripts"; exit 1; }
        mkdir -p ibm/examples/ai || { echo "Failed to create ibm/examples/ai"; exit 1; }
        mkdir -p ibm/examples/cloud || { echo "Failed to create ibm/examples/cloud"; exit 1; }
        mkdir -p ibm/examples/containers || { echo "Failed to create ibm/examples/containers"; exit 1; }

        echo "Creating files if they do not exist..."
        [ ! -f ibm/docs/getting-started.md ] && echo "# Getting Started with IBM LinuxONE" > ibm/docs/getting-started.md || echo "ibm/docs/getting-started.md already exists"
        [ ! -f ibm/docs/architecture.md ] && echo "# Architecture Overview" > ibm/docs/architecture.md || echo "ibm/docs/architecture.md already exists"
        [ ! -f ibm/docs/security.md ] && echo "# Security Guidelines" > ibm/docs/security.md || echo "ibm/docs/security.md already exists"

        [ ! -f ibm/scripts/deploy.sh ] && echo "#!/bin/bash\n# Deployment script\n" > ibm/scripts/deploy.sh || echo "ibm/scripts/deploy.sh already exists"
        [ ! -f ibm/scripts/backup.sh ] && echo "#!/bin/bash\n# Backup script\n" > ibm/scripts/backup.sh || echo "ibm/scripts/backup.sh already exists"
        [ ! -f ibm/scripts/monitor.sh ] && echo "#!/bin/bash\n# Monitoring script\n" > ibm/scripts/monitor.sh || echo "ibm/scripts/monitor.sh already exists"

        [ ! -f ibm/examples/ai/ai_example_1.py ] && echo "# AI Example 1\nprint('Hello, AI 1')" > ibm/examples/ai/ai_example_1.py || echo "ibm/examples/ai/ai_example_1.py already exists"
        [ ! -f ibm/examples/ai/ai_example_2.py ] && echo "# AI Example 2\nprint('Hello, AI 2')" > ibm/examples/ai/ai_example_2.py || echo "ibm/examples/ai/ai_example_2.py already exists"

        [ ! -f ibm/examples/cloud/cloud_example_1.yaml ] && echo "# Cloud Example 1\napiVersion: v1\nkind: ConfigMap" > ibm/examples/cloud/cloud_example_1.yaml || echo "ibm/examples/cloud/cloud_example_1.yaml already exists"
        [ ! -f ibm/examples/cloud/cloud_example_2.yaml ] && echo "# Cloud Example 2\napiVersion: v1\nkind: Pod" > ibm/examples/cloud/cloud_example_2.yaml || echo "ibm/examples/cloud/cloud_example_2.yaml already exists"

        [ ! -f ibm/examples/containers/container_example_1.dockerfile ] && echo "# Container Example 1\nFROM ubuntu:latest\nRUN apt-get update" > ibm/examples/containers/container_example_1.dockerfile || echo "ibm/examples/containers/container_example_1.dockerfile already exists"
        [ ! -f ibm/examples/containers/container_example_2.dockerfile ] && echo "# Container Example 2\nFROM alpine:latest\nRUN apk add --no-cache bash" > ibm/examples/containers/container_example_2.dockerfile || echo "ibm/examples/containers/container_example_2.dockerfile already exists"

        [ ! -f LICENSE ] && echo "MIT License\n\nCopyright (c) 2024 Skunkworks" > LICENSE || echo "LICENSE already exists"
        [ ! -f README.md ] && echo "# IBM LinuxONE Repository\n\nWelcome to the IBM LinuxONE Repository by Skunkworks.\n\n## Advocacy and Contributions\n\nWe encourage our team and community to contribute to this repository. Share your ideas, report issues, and submit pull requests to help us improve and grow.\n\nFor more information, contact us at [info@skunkworks.africa](mailto:info@skunkworks.africa)." > README.md || echo "README.md already exists"

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add ibm/ LICENSE README.md
        git diff-index --quiet HEAD || git commit -m 'Create directory structure and initial files with content'
        git push || echo "No changes to push"

    - name: Install GitHub CLI
      uses: actions/setup-node@v3
      with:
        node-version: '16'

    - name: Install GitHub CLI
      run: |
        curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
        sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
        echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
        sudo apt-get update
        sudo apt-get install gh

    - name: Ensure Labels Exist
      run: |
        gh label create "documentation" --description "Documentation related changes" --color "#1d76db" || echo "Label 'documentation' already exists"
        gh label create "enhancement" --description "New feature or request" --color "#a2eeef" || echo "Label 'enhancement' already exists"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Create a new issue with GitHub CLI
      run: |
        gh issue create --title "New Directory Structure Created" --body "$(cat .github/ISSUE_TEMPLATE/new-structure.md)" --label "documentation,enhancement"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Send notification to Slack
      uses: slackapi/slack-github-action@v1.23.0
      with:
        slack-message: "New directory structure and initial content have been created in the IBM LinuxONE repository. Please check it out and start contributing! :tada:"
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
