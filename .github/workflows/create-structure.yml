name: Create Directory Structure with Initial Content

on:
  push:
    branches:
      - main

jobs:
  create-structure:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Create directories and files
      run: |
        set -x  # Enable debugging
        echo "Creating directories..."
        mkdir -p ibm/docs || { echo "Failed to create ibm/docs"; exit 1; }
        mkdir -p ibm/scripts || { echo "Failed to create ibm/scripts"; exit 1; }
        mkdir -p ibm/examples/ai || { echo "Failed to create ibm/examples/ai"; exit 1; }
        mkdir -p ibm/examples/cloud || { echo "Failed to create ibm/examples/cloud"; exit 1; }
        mkdir -p ibm/examples/containers || { echo "Failed to create ibm/examples/containers"; exit 1; }

        echo "Creating files if they do not exist..."
        [ ! -f ibm/docs/getting-started.md ] && echo "# Getting Started with IBM LinuxONE" > ibm/docs/getting-started.md || echo "ibm/docs/getting-started.md already exists"
        [ ! -f ibm/docs/architecture.md ] && echo "# Architecture Overview" > ibm/docs/architecture.md || echo "ibm/docs/architecture.md already exists"
        [ ! -f ibm/docs/security.md ] && echo "# Security Guidelines" > ibm/docs/security.md || echo "ibm/docs/security.md already exists"

        [ ! -f ibm/scripts/deploy.sh ] && echo "#!/bin/bash\n# Deployment script\n" > ibm/scripts/deploy.sh || echo "ibm/scripts/deploy.sh already exists"
        [ ! -f ibm/scripts/backup.sh ] && echo "#!/bin/bash\n# Backup script\n" > ibm/scripts/backup.sh || echo "ibm/scripts/backup.sh already exists"
        [ ! -f ibm/scripts/monitor.sh ] && echo "#!/bin/bash\n# Monitoring script\n" > ibm/scripts/monitor.sh || echo "ibm/scripts/monitor.sh already exists"

        [ ! -f ibm/examples/ai/ai_example_1.py ] && echo "# AI Example 1\nprint('Hello, AI 1')" > ibm/examples/ai/ai_example_1.py || echo "ibm/examples/ai/ai_example_1.py already exists"
        [ ! -f ibm/examples/ai/ai_example_2.py ] && echo "# AI Example 2\nprint('Hello, AI 2')" > ibm/examples/ai/ai_example_2.py || echo "ibm/examples/ai/ai_example_2.py already exists"

        [ ! -f ibm/examples/cloud/cloud_example_1.yaml ] && echo "# Cloud Example 1\napiVersion: v1\nkind: ConfigMap" > ibm/examples/cloud/cloud_example_1.yaml || echo "ibm/examples/cloud/cloud_example_1.yaml already exists"
        [ ! -f ibm/examples/cloud/cloud_example_2.yaml ] && echo "# Cloud Example 2\napiVersion: v1\nkind: Pod" > ibm/examples/cloud/cloud_example_2.yaml || echo "ibm/examples/cloud/cloud_example_2.yaml already exists"

        [ ! -f ibm/examples/containers/container_example_1.dockerfile ] && echo "# Container Example 1\nFROM ubuntu:latest\nRUN apt-get update" > ibm/examples/containers/container_example_1.dockerfile || echo "ibm/examples/containers/container_example_1.dockerfile already exists"
        [ ! -f ibm/examples/containers/container_example_2.dockerfile ] && echo "# Container Example 2\nFROM alpine:latest\nRUN apk add --no-cache bash" > ibm/examples/containers/container_example_2.dockerfile || echo "ibm/examples/containers/container_example_2.dockerfile already exists"

        [ ! -f LICENSE ] && echo "MIT License\n\nCopyright (c) 2024 Skunkworks" > LICENSE || echo "LICENSE already exists"
        
    - name: Download Course Catalog JSON
      run: |
        curl -o courses.json https://www.ibm.com/training/files/GTPjson/CourseFeed_Global.json

    - name: Process Course Catalog and Update README.md
      run: |
        set -x  # Enable debugging
        echo "Parsing JSON and updating README.md"
        courses=$(jq -r '.COURSES[] | "\(.TITLE) - \(.URL)"' courses.json)

        {
          echo "# IBM LinuxONE Repository"
          echo ""
          echo "![GitHub release (latest by date)](https://img.shields.io/github/v/release/skunkworksza/ibm)"
          echo "![GitHub last commit](https://img.shields.io/github/last-commit/skunkworksza/ibm)"
          echo "![GitHub issues](https://img.shields.io/github/issues/skunkworksza/ibm)"
          echo "![GitHub pull requests](https://img.shields.io/github/issues-pr/skunkworksza/ibm)"
          echo ""
          echo "Welcome to the IBM LinuxONE Repository by Skunkworks. This repository contains various resources, scripts, and guides to help you get the most out of your IBM LinuxONE infrastructure."
          echo ""
          echo "## ðŸ“‚ Directory Structure"
          echo ""
          echo "\`\`\`plaintext"
          echo "ibm/"
          echo "â”œâ”€â”€ docs/"
          echo "â”‚   â”œâ”€â”€ getting-started.md"
          echo "â”‚   â”œâ”€â”€ architecture.md"
          echo "â”‚   â””â”€â”€ security.md"
          echo "â”œâ”€â”€ scripts/"
          echo "â”‚   â”œâ”€â”€ deploy.sh"
          echo "â”‚   â”œâ”€â”€ backup.sh"
          echo "â”‚   â””â”€â”€ monitor.sh"
          echo "â”œâ”€â”€ examples/"
          echo "â”‚   â”œâ”€â”€ ai/"
          echo "â”‚   â”‚   â”œâ”€â”€ ai_example_1.py"
          echo "â”‚   â”‚   â””â”€â”€ ai_example_2.py"
          echo "â”‚   â”œâ”€â”€ cloud/"
          echo "â”‚   â”‚   â”œâ”€â”€ cloud_example_1.yaml"
          echo "â”‚   â”‚   â””â”€â”€ cloud_example_2.yaml"
          echo "â”‚   â””â”€â”€ containers/"
          echo "â”‚       â”œâ”€â”€ container_example_1.dockerfile"
          echo "â”‚       â””â”€â”€ container_example_2.dockerfile"
          echo "â”œâ”€â”€ LICENSE"
          echo "â””â”€â”€ README.md"
          echo "\`\`\`"
          echo ""
          echo "## âœ¨ Key Features"
          echo "- **Comprehensive Documentation**: Step-by-step guides to get you started with IBM LinuxONE."
          echo "- **Automation Scripts**: Useful scripts for deploying, backing up, and monitoring your LinuxONE environment."
          echo "- **Examples**: Real-world examples of AI, cloud, and container applications."
          echo ""
          echo "## ðŸ“– Learning Resources"
          echo "- [IBM LinuxONE Overview](https://www.ibm.com/it-infrastructure/linuxone)"
          echo "- [Getting Started with IBM LinuxONE](https://www.ibm.com/it-infrastructure/linuxone/get-started)"
          echo "- [IBM Developer: LinuxONE Tutorials](https://developer.ibm.com/tutorials/?search=linuxone)"
          echo "- [IBM Redbooks: LinuxONE](https://www.redbooks.ibm.com/Redbooks.nsf/domains/linuxone)"
          echo ""
          echo "## ðŸ“š Course Catalog"
          for course in $courses; do
            echo "- $course"
          done
          echo ""
          echo "## ðŸŽ“ Educational Content"
          echo "| Resource | Description |"
          echo "|----------|-------------|"
          echo "| [LinuxONE Academy](https://www.ibm.com/it-infrastructure/linuxone/academy) | In-depth courses on LinuxONE. |"
          echo "| [IBM Training](https://www.ibm.com/training) | Broad range of IBM training courses. |"
          echo "| [IBM Cloud Docs](https://cloud.ibm.com/docs) | Documentation for IBM Cloud services. |"
          echo "| [Coursera: IBM Courses](https://www.coursera.org/ibm) | Online courses offered by IBM. |"
          echo ""
          echo "## ðŸ“¢ Famous Quotes"
          echo "> \"The great thing about LinuxONE is the combination of performance, security, and scalability.\""
          echo "> â€“ **Arvind Krishna, CEO of IBM**"
          echo ""
          echo "> \"IBM LinuxONE provides a superior experience for businesses that demand high availability and secure transactions.\""
          echo "> â€“ **Ginni Rometty, Former CEO of IBM**"
          echo ""
          echo "## ðŸ› ï¸ How to Contribute"
          echo "1. **Fork the repository**."
          echo "2. **Create a new branch** (`git checkout -b feature-branch`)."
          echo "3. **Commit your changes** (`git commit -m 'Add new feature'`)."
          echo "4. **Push to the branch** (`git push origin feature-branch`)."
          echo "5. **Create a new Pull Request**."
          echo ""
          echo "## ðŸ“ž Contact"
          echo "For any queries or support, please contact us at [info@skunkworks.africa](mailto:info@skunkworks.africa)."
          echo ""
          echo "## ðŸ“„ License"
          echo "This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details."
          echo ""
          echo "![IBM Logo](https://upload.wikimedia.org/wikipedia/commons/5/51/IBM_logo.svg)"
          echo ""
          echo "_Stay tuned for more updates and contributions!_ ðŸŒðŸš€"
        } > README.md

    - name: Commit and push changes
      run: |
        git config --global user.name 'github-actions[bot]'
        git config --global user.email 'github-actions[bot]@users.noreply.github.com'
        git add ibm/ LICENSE README.md
        git diff-index --quiet HEAD || git commit -m 'Create directory structure and initial files with content'
        git push || echo "No changes to push"

    - name: Install GitHub CLI
      uses: actions/setup-node@v3
      with:
        node-version: '16'

    - name: Install GitHub CLI
      run: |
        curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo dd of=/usr/share/keyrings/githubcli-archive-keyring.gpg
        sudo chmod go+r /usr/share/keyrings/githubcli-archive-keyring.gpg
        echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
        sudo apt-get update
        sudo apt-get install gh

    - name: Ensure Labels Exist
      run: |
        gh label create "documentation" --description "Documentation related changes" --color "#1d76db" || echo "Label 'documentation' already exists"
        gh label create "enhancement" --description "New feature or request" --color "#a2eeef" || echo "Label 'enhancement' already exists"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Create a new issue with GitHub CLI
      run: |
        gh issue create --title "New Directory Structure Created" --body "A new directory structure and initial files have been created in the IBM LinuxONE repository. Please review and contribute!" --label "documentation,enhancement"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Send notification to Slack
      uses: slackapi/slack-github-action@v1.23.0
      with:
        slack-message: "New directory structure and initial content have been created in the IBM LinuxONE repository. Please check it out and start contributing! :tada:"
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
